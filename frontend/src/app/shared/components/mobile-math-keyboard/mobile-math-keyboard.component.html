<!-- Mobile Math Keyboard -->
<div
  class="mobile-math-keyboard"
  [ngClass]="{ visible: isMobile && isVisible }"
  *ngIf="isMobile"
>
  <!-- Keyboard Header with Tab Navigation -->
  <div class="keyboard-header">
    <button
      *ngFor="let tab of keyboardTabs"
      [ngClass]="{ active: activeTab === tab.id }"
      (click)="setActiveTab(tab.id)"
      class="tab-button"
    >
      {{ tab.name }}
    </button>
    <!-- Botón de cerrar teclado móvil -->
    <button
      class="keyboard-close-btn"
      (click)="hideMobileKeyboard()"
      title="Cerrar teclado"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        viewBox="0 0 16 16"
      >
        <path
          d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
        />
      </svg>
    </button>
  </div>

  <!-- Numbers Tab -->
  <div class="keyboard-content" *ngIf="activeTab === 'numbers'">
    <div class="key-row">
      <button class="number-key" (click)="insertMath('7')">7</button>
      <button class="number-key" (click)="insertMath('8')">8</button>
      <button class="number-key" (click)="insertMath('9')">9</button>
      <button
        class="operation-key delete-key"
        (click)="deleteMath()"
        title="Borrar"
      >
        ⌫
      </button>
    </div>
    <div class="key-row">
      <button class="number-key" (click)="insertMath('4')">4</button>
      <button class="number-key" (click)="insertMath('5')">5</button>
      <button class="number-key" (click)="insertMath('6')">6</button>
      <button class="operation-key" (click)="insertMath('-')" title="Resta">
        −
      </button>
    </div>
    <div class="key-row">
      <button class="number-key" (click)="insertMath('1')">1</button>
      <button class="number-key" (click)="insertMath('2')">2</button>
      <button class="number-key" (click)="insertMath('3')">3</button>
      <button
        class="operation-key"
        (click)="insertMath('\\cdot')"
        title="Multiplicación"
      >
        ×
      </button>
    </div>
    <div class="key-row">
      <button class="number-key" (click)="insertMath('0')">0</button>
      <button
        class="number-key"
        (click)="insertMath('.')"
        title="Punto decimal"
      >
        .
      </button>
      <button class="operation-key" (click)="insertMath('+')" title="Suma">
        +
      </button>
      <button
        class="operation-key"
        (click)="insertMath('\\frac{}{}')"
        title="División"
      >
        ÷
      </button>
    </div>
    <!-- Botón de cerrar teclado -->
    <div class="key-row">
      <button
        class="close-keyboard-key"
        (click)="hideMobileKeyboard()"
        title="Cerrar teclado"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          viewBox="0 0 16 16"
        >
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
          />
        </svg>
        Cerrar
      </button>
    </div>
  </div>

  <!-- Basics Tab (Variables y paréntesis) -->
  <div class="keyboard-content" *ngIf="activeTab === 'basics'">
    <div class="keyboard-section-header">
      <h5 class="keyboard-section-title">Variables</h5>
      <button class="section-delete-key" (click)="deleteMath()" title="Borrar">
        ⌫
      </button>
    </div>
    <div class="key-row">
      <button
        class="operation-key variable-key"
        (click)="insertMath('x')"
        title="Variable x"
      >
        x
      </button>
      <button
        class="operation-key variable-key"
        (click)="insertMath('t')"
        title="Variable t"
      >
        t
      </button>
      <button class="operation-key" (click)="insertMath('\\pi')" title="Pi">
        π
      </button>
      <button class="operation-key" (click)="insertMath('e')" title="Número e">
        e
      </button>
    </div>

    <div class="key-section">
      <h5 class="keyboard-section-title">Paréntesis</h5>
      <div class="key-row">
        <button
          class="function-key"
          (click)="insertMath('\\left(\\right)')"
          title="Paréntesis"
        >
          <span [innerHTML]="'$$(\\square)$$'"></span>
        </button>
        <button
          class="function-key"
          (click)="insertMath('\\left[\\right]')"
          title="Corchetes"
        >
          <span [innerHTML]="'$$[\\square]$$'"></span>
        </button>
        <button
          class="function-key"
          (click)="insertMath('\\left\\{\\right\\}')"
          title="Llaves"
        >
          <span [innerHTML]="'$$\\{\\square\\}$$'"></span>
        </button>
      </div>
    </div>
    <!-- Botón de cerrar teclado -->
    <div class="key-row">
      <button
        class="close-keyboard-key"
        (click)="hideMobileKeyboard()"
        title="Cerrar teclado"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          viewBox="0 0 16 16"
        >
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
          />
        </svg>
        Cerrar
      </button>
    </div>
  </div>

  <!-- Advanced Tab (Potencias, raíces, fracciones) -->
  <div class="keyboard-content" *ngIf="activeTab === 'advanced'">
    <div class="keyboard-section-header">
      <h5 class="keyboard-section-title">Potencias y Raíces</h5>
      <button class="section-delete-key" (click)="deleteMath()" title="Borrar">
        ⌫
      </button>
    </div>
    <div class="key-row">
      <button
        class="function-key"
        (click)="insertMath('\\square^{}')"
        title="Potencia"
      >
        <span [innerHTML]="'$$\\square^{n}$$'"></span>
      </button>
      <button
        class="function-key"
        (click)="insertMath('\\sqrt{}')"
        title="Raíz cuadrada"
      >
        <span [innerHTML]="'$$\\sqrt{\\square}$$'"></span>
      </button>
      <button
        class="function-key"
        (click)="insertMath('\\sqrt[n]{}')"
        title="Raíz n-ésima"
      >
        <span [innerHTML]="'$$\\sqrt[n]{\\square}$$'"></span>
      </button>
    </div>

    <div class="key-section">
      <h5 class="keyboard-section-title">Fracciones</h5>
      <div class="key-row">
        <button
          class="function-key"
          (click)="insertMath('\\frac{}{}')"
          title="Fracción"
        >
          <span [innerHTML]="'$$\\frac{\\square}{\\square}$$'"></span>
        </button>
      </div>
    </div>
    <!-- Botón de cerrar teclado -->
    <div class="key-row">
      <button
        class="close-keyboard-key"
        (click)="hideMobileKeyboard()"
        title="Cerrar teclado"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          viewBox="0 0 16 16"
        >
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
          />
        </svg>
        Cerrar
      </button>
    </div>
  </div>

  <!-- Trigonometric Tab -->
  <div class="keyboard-content" *ngIf="activeTab === 'trigonometric'">
    <div class="keyboard-section-header">
      <h5 class="keyboard-section-title">Funciones Trigonométricas</h5>
      <button class="section-delete-key" (click)="deleteMath()" title="Borrar">
        ⌫
      </button>
    </div>
    <div class="key-grid">
      <button
        class="function-key"
        *ngFor="let button of mathButtonsTrig"
        (click)="insertMath(button.latex)"
        [title]="button.tooltip"
      >
        <span [innerHTML]="'$$' + button.display + '$$'"></span>
      </button>
    </div>
    <!-- Botón de cerrar teclado -->
    <div class="key-row">
      <button
        class="close-keyboard-key"
        (click)="hideMobileKeyboard()"
        title="Cerrar teclado"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          viewBox="0 0 16 16"
        >
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
          />
        </svg>
        Cerrar
      </button>
    </div>
  </div>

  <!-- Functions Tab -->
  <div class="keyboard-content" *ngIf="activeTab === 'functions'">
    <div class="keyboard-section-header">
      <h5 class="keyboard-section-title">Funciones Matemáticas</h5>
      <button class="section-delete-key" (click)="deleteMath()" title="Borrar">
        ⌫
      </button>
    </div>
    <div class="key-grid">
      <button
        class="function-key"
        *ngFor="let button of mathButtonsBasic"
        (click)="insertMath(button.latex)"
        [title]="button.tooltip"
      >
        <span [innerHTML]="'$$' + button.display + '$$'"></span>
      </button>
    </div>
    <!-- Botón de cerrar teclado -->
    <div class="key-row">
      <button
        class="close-keyboard-key"
        (click)="hideMobileKeyboard()"
        title="Cerrar teclado"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          fill="currentColor"
          viewBox="0 0 16 16"
        >
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
          />
        </svg>
        Cerrar
      </button>
    </div>
  </div>
</div>
