<div
  class="min-h-screen app-container font-sans p-4 flex items-center justify-center"
>
  <div
    class="w-full max-w-5xl card rounded-xl shadow-2xl p-8 border text-inherit"
  >
    <h1 class="text-2xl font-bold text-center mb-6 main-title">
      Calculadora de Series de Fourier
    </h1>

    <!-- Math Keyboard Toggle Button -->
    <div class="flex justify-center mb-4">
      <button
        (click)="toggleKeyboard()"
        class="keyboard-toggle-btn flex items-center justify-center gap-2 px-5 py-2.5 btn-primary rounded-lg transition-all duration-300"
        [ngClass]="{ active: keyboardVisible }"
      >
        <div class="keyboard-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            fill="currentColor"
            class="bi bi-keyboard"
            viewBox="0 0 16 16"
          >
            <path
              d="M2 3h12a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2zm1 2h1v1H3V6zm2 0h1v1H5V6zm2 0h1v1H7V6zm2 0h1v1h-1V6zm2 0h1v1h-1V6zM3 8h1v1H3V8zm2 0h1v1H5V8zm2 0h1v1H7V8zm2 0h1v1h-1V8zm2 0h1v1h-1V8zM3 10h1v1H3v-1zm2 0h1v1H5v-1zm2 0h4v1H7v-1z"
            />
          </svg>
        </div>
        <!-- <span>Teclado Matemático</span> -->
        <div class="arrow-icon ml-1">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"
            />
          </svg>
        </div>
      </button>
    </div>

    <!-- Math Keyboard Container with Animation -->
    <div
      class="keyboard-container mb-6 px-2 py-3 section-container rounded-lg border transition-all"
      [ngClass]="{ visible: keyboardVisible }"
    >
      <!-- Título del teclado -->
      <h3 class="text-base mb-3 font-medium flex items-center px-2">
        <span class="w-1 h-1 dot-indicator rounded-full mr-2"></span>
        <span class="section-header">Funciones Disponibles</span>
      </h3>

      <div class="flex flex-wrap justify-center gap-1">
        <!-- Operadores Básicos -->
        <button
          *ngFor="let button of mathButtonsBasic"
          (click)="insertMath(button.latex)"
          class="math-keyboard-btn"
          [title]="button.tooltip"
        >
          <span [innerHTML]="'$$' + button.display + '$$'"></span>
        </button>

        <!-- Funciones Trigonométricas -->
        <button
          *ngFor="let button of mathButtonsTrig"
          (click)="insertMath(button.latex)"
          class="math-keyboard-btn"
          [title]="button.tooltip"
        >
          <span [innerHTML]="'$$' + button.display + '$$'"></span>
        </button>
      </div>
    </div>

    <!-- Variable Selection -->
    <div class="mb-6 section-container p-4 rounded-lg border transition-all">
      <h3 class="text-base mb-3 font-medium flex items-center">
        <span class="w-1 h-1 dot-indicator rounded-full mr-2"></span>
        <span class="section-header">Variable de Integración</span>
      </h3>

      <select
        id="variable"
        name="variable"
        [(ngModel)]="selectedVariable"
        (change)="updateFunctionDisplay()"
        class="w-full p-2.5 select text-sm border rounded-md focus:outline-none"
      >
        <option value="x">x (Espacial)</option>
        <option value="t">t (Temporal)</option>
      </select>
    </div>

    <!-- Piecewise Function Input -->
    <div class="mb-6 section-container p-4 rounded-lg border transition-all">
      <h3 class="text-base mb-3 font-medium flex items-center">
        <span class="w-1 h-1 dot-indicator rounded-full mr-2"></span>
        <span class="section-header">Función f({{ selectedVariable }})</span>
      </h3>

      <div
        id="functionDisplay"
        class="text-lg mb-3 p-2 border function-display rounded-md"
      ></div>

      <div
        #pieceContainer
        id="pieceContainer"
        class="border piece-container rounded-md p-3"
      >
        <div
          class="flex items-center mb-3"
          *ngFor="let piece of pieces; let i = index"
        >
          <div class="flex-1 flex items-center" style="width: 85%">
            <div
              class="math-field pieceFunc rounded-md min-h-[50px] min-w-[50px] flex items-center justify-center cursor-text transition-colors"
              style="width: 55%"
            ></div>
            <span class="mx-2 text-lg math-operator" tabindex="-1">$$,$$</span>
            <div
              class="math-field pieceStart rounded-md min-h-[50px] min-w-[25px] flex items-center justify-center cursor-text transition-colors"
              style="width: 15%"
            ></div>
            <span class="mx-1 text-lg variable-span" tabindex="-1"
              >$$< {{ selectedVariable }} <$$</span
            >
            <div
              class="math-field pieceEnd rounded-md min-h-[50px] min-w-[25px] flex items-center justify-center cursor-text transition-colors"
              style="width: 15%"
            ></div>
          </div>
          <div
            class="flex-none flex flex-col items-center justify-center"
            style="width: 15%"
          >
            <button
              *ngIf="i === 0"
              (click)="addPiece()"
              class="font-bold w-8 h-8 mx-auto mb-1 flex items-center justify-center btn-primary rounded-full hover:scale-110 transition-all"
            >
              +
            </button>
            <button
              *ngIf="i > 0"
              (click)="removePiece(i)"
              class="font-bold w-8 h-8 mx-auto mb-1 flex items-center justify-center bg-red-500 text-white rounded-full hover:bg-red-600 hover:scale-110 transition-all"
            >
              -
            </button>
            <span
              class="text-xs text-center text-button-label w-full font-medium"
            >
              {{ i === 0 ? "Añadir trozo" : "Quitar trozo" }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Series Type Selection -->
    <div class="mb-8 section-container p-4 rounded-lg border transition-all">
      <h3 class="text-base mb-3 font-medium flex items-center">
        <span class="w-1 h-1 dot-indicator rounded-full mr-2"></span>
        <span class="section-header">Tipo de Cálculo</span>
      </h3>

      <!-- Stepper para elegir entre Serie o Transformada -->
      <div class="mb-4">
        <div
          class="flex justify-between bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden"
        >
          <button
            [ngClass]="{
              'bg-primary text-blue-500 dark:text-green-500':
                calculationType === 'series',
              'bg-transparent text-black dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600':
                calculationType !== 'series'
            }"
            class="flex-1 py-2 transition-colors duration-200"
            (click)="setCalculationType('series')"
          >
            Series de Fourier
          </button>
          <button
            [ngClass]="{
              'bg-primary text-blue-500 dark:text-green-500':
                calculationType === 'dft',
              'bg-transparent text-black dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600':
                calculationType !== 'dft'
            }"
            class="flex-1 py-2 transition-colors duration-200"
            (click)="setCalculationType('dft')"
          >
            Transformada Discreta (DFT)
          </button>
        </div>
      </div>

      <!-- Opciones para Series de Fourier -->
      <div
        *ngIf="calculationType === 'series'"
        class="transition-opacity duration-300"
      >
        <label for="type" class="block mb-2 text-sm font-medium"
          >Selecciona el tipo de Serie:</label
        >
        <select
          id="type"
          name="type"
          [(ngModel)]="seriesType"
          class="w-full p-2.5 select text-sm border rounded-md focus:outline-none"
        >
          <option value="" disabled selected>
            Selecciona el tipo de Serie de Fourier
          </option>
          <option value="trigonometric">Trigonométrica</option>
          <option value="complex">Compleja</option>
          <option value="halfrange">Medio Rango</option>
        </select>
      </div>

      <!-- Opciones para Transformada Discreta -->
      <div
        *ngIf="calculationType === 'dft'"
        class="transition-opacity duration-300"
      >
        <p class="text-sm mb-3">
          La Transformada Discreta de Fourier permite analizar funciones no
          integrables analíticamente mediante muestreo numérico.
        </p>

        <!-- Parámetros específicos para DFT -->
        <div class="grid grid-cols-2 gap-4 mb-2">
          <div>
            <label for="numSamples" class="block mb-1 text-sm font-medium"
              >Número de muestras:</label
            >
            <select
              id="numSamples"
              [(ngModel)]="dftParams.numSamples"
              class="w-full p-2 border rounded-md text-sm focus:outline-none"
            >
              <option *ngFor="let value of powersOfTwo" [value]="value">
                {{ value }}
              </option>
            </select>
          </div>
          <div>
            <label for="sampleRate" class="block mb-1 text-sm font-medium"
              >Número de periodos:</label
            >
            <input
              type="number"
              id="sampleRate"
              [(ngModel)]="dftParams.sampleRate"
              min="0"
              class="w-full p-2 border rounded-md text-sm focus:outline-none"
              placeholder="1"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="text-center">
      <button
        id="submitButton"
        (click)="
          calculationType === 'series' ? submitData() : submitDftCalculation()
        "
        class="px-6 py-3 btn-primary rounded-lg transition-all duration-300 font-medium"
      >
        {{
          calculationType === "series"
            ? "Calcular Serie de Fourier"
            : "Calcular Transformada Discreta"
        }}
      </button>
    </div>
  </div>
</div>

<!-- Botón de cambio de tema -->
<app-theme-toggle></app-theme-toggle>
<app-survey-button></app-survey-button>
